<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sandbox OS Pro · AI Workspace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght=400&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        slate: { 850: '#151e2e', 950: '#020617' }
                    }
                }
            }
        }
    </script>
    <style>
        /* --- 全局与背景 --- */
        body {
            background-color: #0f111a;
            background-image:
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(139, 92, 246, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(5, 150, 105, 0.1) 0px, transparent 50%);
            background-attachment: fixed;
            color: #e2e8f0;
            overflow: hidden;
            height: 100vh;
        }

        /* --- 滚动条美化 --- */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(148, 163, 184, 0.2); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(148, 163, 184, 0.4); }

        /* --- 应用窗口样式 --- */
        #app-container {
            /* 模拟桌面应用的浮动和阴影 */
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8),
                        0 0 0 1px rgba(255, 255, 255, 0.08);
            border-radius: 1.5rem;
            overflow: hidden; /* 确保内容在动画时不会溢出 */
            background-color: #0f111a;
        }

        /* --- 侧边栏动效与布局自适应 (关键) --- */
        #ai-sidebar {
            width: 420px;
            transform: translateX(0);
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        #ai-sidebar.collapsed {
            transform: translateX(100%);
            width: 0;
            padding: 0;
            margin: 0;
            /* 确保在收缩时，内容完全不可见且不占据空间 */
            opacity: 0;
            overflow: hidden;
        }
        /* 主工作区自适应 */
        #main-stage {
            flex-grow: 1;
            transition: width 0.4s, flex-grow 0.4s;
        }

        /* 其他原有样式 (为简洁省略，实际文件中已包含) */
        .glass-card {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        .bubble-ai {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-bottom-left-radius: 2px;
        }
        .bubble-user {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            border-bottom-right-radius: 2px;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }
        .input-area {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        .modal-overlay {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(12px);
        }
    </style>
</head>
<body class="flex overflow-hidden relative">

    <!-- 1. 悬浮的 AI 机器人图标 (大眼仔) -->
    <button id="floating-robot" onclick="openWorkspace()"
            class="fixed bottom-10 right-10 z-[100] w-20 h-20 rounded-full bg-slate-900 border-4 border-indigo-600 shadow-2xl shadow-indigo-600/50 flex items-center justify-center transform scale-100 transition-all duration-500 hover:scale-110 active:scale-95 cursor-pointer">
        <!-- 模拟大眼仔图标 -->
        <img src="https://placehold.co/80x80/2f3e4e/4f46e5?text=Robot" alt="AI Robot Icon" class="w-16 h-16 object-contain rounded-full">
    </button>

    <!-- 2. 应用主窗口容器 (初始隐藏) -->
    <div id="app-container" class="fixed inset-0 m-12 hidden opacity-0 transform scale-[0.5] transition-all duration-500">

        <!-- 窗口内容 (原有的 main 和 aside 结构) -->
        <div class="flex h-full w-full">

            <!-- 主工作区 (Sandbox) -->
            <main class="flex-1 relative p-8 md:p-12 flex flex-col h-full overflow-y-auto" id="main-stage">

                <div class="sandbox-container flex flex-col max-w-7xl mx-auto w-full sandbox-stage">
                    <!-- 头部 -->
                    <header class="flex justify-between items-end mb-10 pb-4 border-b border-white/5">
                        <div>
                            <div class="flex items-center gap-3 mb-1">
                                <div class="w-8 h-8 rounded bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg shadow-indigo-500/20">
                                    <i class="fa-solid fa-cube text-white text-sm"></i>
                                </div>
                                <h1 class="text-2xl font-bold tracking-tight text-white">Sandbox OS <span class="text-xs align-top bg-white/10 px-1.5 py-0.5 rounded text-slate-300 font-normal">PRO</span></h1>
                            </div>
                            <p class="text-slate-400 text-sm ml-11">工作区 / 财务分析项目 Alpha</p>
                        </div>

                        <div class="flex gap-3">
                            <button class="px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 text-sm border border-slate-700 transition flex items-center gap-2">
                                <i class="fa-solid fa-filter"></i> 筛选
                            </button>
                            <button onclick="document.getElementById('global-upload').click()" class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-medium shadow-lg shadow-indigo-500/25 transition hover:scale-105 active:scale-95 flex items-center gap-2">
                                <i class="fa-solid fa-cloud-arrow-up"></i> 上传文件
                            </button>
                            <input type="file" id="global-upload" hidden multiple />
                            <!-- 新增：关闭按钮 -->
                            <button onclick="closeWorkspace()" class="w-10 h-10 rounded-lg hover:bg-white/5 text-slate-400 hover:text-white flex items-center justify-center transition" title="关闭应用">
                                <i class="fa-solid fa-power-off"></i>
                            </button>
                        </div>
                    </header>

                    <!-- 文件网格 (Sandbox Drag & Drop) -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pb-20 pr-2">

                        <!-- PDF 卡片 -->
                        <div class="glass-card sandbox-file-card p-5 rounded-2xl h-48 flex flex-col justify-between group cursor-pointer" onclick="openFileViewer('Q3_Financial_Report_Final.pdf')">
                            <div class="flex justify-between items-start">
                                <div class="w-10 h-10 rounded-lg bg-red-500/10 text-red-400 flex items-center justify-center text-xl border border-red-500/10">
                                    <i class="fa-regular fa-file-pdf"></i>
                                </div>
                                <button class="text-slate-600 hover:text-white transition"><i class="fa-solid fa-ellipsis"></i></button>
                            </div>
                            <div>
                                <h3 class="font-medium text-slate-200 group-hover:text-white truncate">Q3_Financial_Report_Final.pdf</h3>
                                <div class="flex items-center justify-between mt-3">
                                    <span class="text-xs text-slate-500 font-mono">12.4 MB</span>
                                    <span class="text-xs text-slate-500">刚刚</span>
                                </div>
                            </div>
                        </div>

                        <!-- 图片卡片 -->
                        <div class="glass-card sandbox-file-card p-5 rounded-2xl h-48 flex flex-col justify-between group cursor-pointer" onclick="openFileViewer('Market_Trend_2024.png')">
                            <div class="flex justify-between items-start">
                                <div class="w-10 h-10 rounded-lg bg-purple-500/10 text-purple-400 flex items-center justify-center text-xl border border-purple-500/10">
                                    <i class="fa-regular fa-image"></i>
                                </div>
                                <div class="px-2 py-0.5 rounded bg-green-500/20 text-green-400 text-[10px] font-bold">已分析</div>
                            </div>
                            <div>
                                <h3 class="font-medium text-slate-200 group-hover:text-white truncate">Market_Trend_2024.png</h3>
                                <div class="flex items-center justify-between mt-3">
                                    <span class="text-xs text-slate-500 font-mono">2.4 MB</span>
                                    <span class="text-xs text-slate-500">3h 前</span>
                                </div>
                            </div>
                        </div>

                        <!-- 代码卡片 -->
                        <div class="glass-card sandbox-file-card p-5 rounded-2xl h-48 flex flex-col justify-between group cursor-pointer" onclick="openFileViewer('data_cleaning_script.py')">
                            <div class="flex justify-between items-start">
                                <div class="w-10 h-10 rounded-lg bg-blue-500/10 text-blue-400 flex items-center justify-center text-xl border border-blue-500/10">
                                    <i class="fa-solid fa-code"></i>
                                </div>
                            </div>
                            <div>
                                <h3 class="font-medium text-slate-200 group-hover:text-white truncate">data_cleaning_script.py</h3>
                                <div class="flex items-center justify-between mt-3">
                                    <span class="text-xs text-slate-500 font-mono">14 KB</span>
                                    <span class="text-xs text-slate-500">昨天</span>
                                </div>
                            </div>
                        </div>

                        <!-- 上传占位符 -->
                        <div class="glass-card rounded-2xl h-48 flex flex-col items-center justify-center border-dashed border-2 border-slate-700 hover:border-indigo-500/50 hover:bg-slate-800/50 transition cursor-pointer group" onclick="document.getElementById('global-upload').click()">
                            <div class="w-12 h-12 rounded-full bg-slate-800 group-hover:bg-indigo-600/20 group-hover:scale-110 transition flex items-center justify-center mb-3">
                                <i class="fa-solid fa-plus text-slate-500 group-hover:text-indigo-400"></i>
                            </div>
                            <span class="text-sm text-slate-400 group-hover:text-slate-200">新建或拖拽文件</span>
                        </div>

                    </div>
                </div>

                <!-- 唤醒按钮 (侧边栏收起时显示，但现在在窗口内) -->
                <button id="wake-btn" onclick="toggleSidebar()" class="absolute bottom-8 right-8 z-30 group transition-all duration-300 hover:scale-110 active:scale-95 hidden">
                    <div class="absolute inset-0 bg-indigo-500 rounded-full blur opacity-40 group-hover:opacity-75 animate-pulse"></div>
                    <div class="relative w-14 h-14 rounded-full bg-slate-900 border border-indigo-500/50 text-indigo-400 flex items-center justify-center shadow-2xl">
                        <i class="fa-solid fa-wand-magic-sparkles text-xl"></i>
                    </div>
                    <span class="absolute right-full mr-4 top-1/2 -translate-y-1/2 px-2 py-1 bg-slate-800 text-xs rounded text-slate-300 opacity-0 group-hover:opacity-100 transition whitespace-nowrap border border-slate-700">唤醒助手</span>
                </button>
            </main>

            <!-- AI 侧边栏 -->
            <aside id="ai-sidebar" class="h-full bg-slate-900/80 backdrop-filter backdrop-blur-2xl border-l border-white/10 flex flex-col shadow-2xl relative z-50">
                <div id="sidebar-content" class="flex flex-col h-full transition-opacity duration-300 opacity-100">
                    <!-- 侧边栏头部 -->
                    <div class="h-16 flex items-center justify-between px-6 border-b border-white/5 bg-slate-900/50 flex-shrink-0">
                        <div class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.5)]"></span>
                            <h2 class="font-semibold text-slate-100 tracking-wide">AI Assistant</h2>
                        </div>
                        <div class="flex gap-2">
                             <button class="w-8 h-8 rounded-lg hover:bg-white/5 text-slate-400 hover:text-white flex items-center justify-center transition">
                                <i class="fa-solid fa-clock-rotate-left"></i>
                            </button>
                            <button onclick="toggleSidebar()" class="w-8 h-8 rounded-lg hover:bg-white/5 text-slate-400 hover:text-white flex items-center justify-center transition" title="收起面板">
                                <i class="fa-solid fa-arrow-right-to-bracket"></i>
                            </button>
                        </div>
                    </div>

                    <!-- 聊天记录区域 -->
                    <div class="flex-1 overflow-y-auto p-6 space-y-8 scroll-smooth" id="chat-container">

                        <!-- AI 消息 -->
                        <div class="flex gap-4">
                            <div class="w-8 h-8 rounded bg-indigo-600/20 text-indigo-400 flex items-center justify-center flex-shrink-0 text-xs font-bold border border-indigo-500/20 mt-1">
                                AI
                            </div>
                            <div class="space-y-2 max-w-[85%]">
                                <div class="bubble-ai p-4 rounded-2xl text-slate-300 text-sm leading-relaxed shadow-sm">
                                    <p>你好！我是您的沙盒助手。我已经连接到当前工作区。</p>
                                    <p class="mt-2">您可以直接拖拽左侧的文件给我，或者让我帮您分析 <span class="text-indigo-400 font-mono cursor-pointer hover:underline bg-indigo-500/10 px-1 rounded">Q3_Financial_Report.pdf</span>。</p>
                                </div>
                            </div>
                        </div>

                        <!-- 用户消息 (带附件样式) -->
                        <div class="flex gap-4 flex-row-reverse">
                            <img src="https://api.dicebear.com/7.x/notionists/svg?seed=Alex" class="w-8 h-8 rounded bg-slate-700 flex-shrink-0 mt-1 border border-white/10">
                            <div class="flex flex-col items-end gap-2 max-w-[85%]">
                                <!-- 附件预览 -->
                                <div class="bg-slate-800/90 border border-slate-600/30 p-2.5 pr-4 rounded-xl flex items-center gap-3 w-auto hover:bg-slate-800 transition cursor-pointer group">
                                       <div class="w-9 h-9 rounded bg-red-500/20 text-red-400 flex items-center justify-center border border-red-500/10 group-hover:border-red-500/30">
                                           <i class="fa-regular fa-file-pdf"></i>
                                       </div>
                                       <div class="text-left">
                                           <p class="text-xs text-slate-200 font-medium group-hover:text-white">Q3_Analysis.pdf</p>
                                           <p class="text-[10px] text-slate-500 font-mono">2.4MB</p>
                                       </div>
                                       <i class="fa-solid fa-xmark text-slate-500 hover:text-red-400 ml-2 text-xs opacity-0 group-hover:opacity-100 transition"></i>
                                </div>
                                <!-- 文本内容 -->
                                <div class="bubble-user p-3.5 px-5 rounded-2xl text-white text-sm shadow-lg">
                                    帮我总结一下这份报告里的三个关键增长点，并生成图表数据。
                                </div>
                                <span class="text-[10px] text-slate-500 pr-1">10:42 AM</span>
                            </div>
                        </div>

                         <!-- AI 思考/加载态 -->
                         <div class="flex gap-4 opacity-0 transition-opacity duration-500" id="loading-indicator">
                            <div class="w-8 h-8 rounded bg-indigo-600/20 text-indigo-400 flex items-center justify-center flex-shrink-0 mt-1">
                                <i class="fa-solid fa-robot animate-pulse"></i>
                            </div>
                            <div class="flex items-center gap-1 h-10">
                                <span class="w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce"></span>
                                <span class="w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></span>
                                <span class="w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></span>
                            </div>
                        </div>

                    </div>

                    <!-- 输入区域 -->
                    <div class="p-5 input-area relative flex-shrink-0">
                        <div id="chat-input-wrapper" class="relative group">
                            <textarea
                                id="chat-input"
                                class="w-full bg-slate-800/50 text-slate-200 text-sm p-4 pr-14 rounded-xl border border-slate-700/50 focus:border-indigo-500/50 focus:ring-1 focus:ring-indigo-500/50 focus:bg-slate-800 focus:outline-none resize-none placeholder-slate-500 transition-all shadow-inner h-14 max-h-40 overflow-y-auto"
                                placeholder="按 / 插入指令，拖入文件..."
                                rows="1"
                            ></textarea>

                            <!-- 输入框右侧按钮 -->
                            <div class="absolute bottom-2.5 right-2 flex items-center gap-1">
                                <button class="p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition" title="上传附件">
                                    <i class="fa-solid fa-paperclip"></i>
                                </button>
                                <button class="p-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg transition shadow-lg shadow-indigo-600/20 transform active:scale-95" onclick="sendMessage()">
                                    <i class="fa-solid fa-arrow-up"></i>
                                </button>
                            </div>
                        </div>
                        <div class="text-center mt-2">
                            <p class="text-[10px] text-slate-600">AI 模型可能生成不准确的信息</p>
                        </div>
                    </div>
                </div>
            </aside>

        </div>
    </div>

    <!-- 文件查看器模态框 (File Viewer Modal) -->
    <div id="file-viewer-modal" class="fixed inset-0 z-[100] hidden items-center justify-center modal-overlay transition-opacity duration-300" onclick="closeFileViewer(event)">
        <div id="modal-content-area" class="modal-content rounded-xl shadow-2xl w-full max-w-4xl h-5/6 flex flex-col transform scale-95 opacity-0 transition-all duration-300" onclick="event.stopPropagation()">
            <div class="p-4 border-b border-white/10 flex justify-between items-center flex-shrink-0">
                <h3 id="file-viewer-title" class="text-lg font-bold text-white">文件预览</h3>
                <button onclick="closeFileViewer()" class="text-slate-400 hover:text-white w-8 h-8 rounded-full hover:bg-slate-700 transition">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="flex-1 p-6 overflow-y-auto text-slate-300 text-sm">
                <!-- 模拟文件内容 -->
                <div class="bg-slate-800 p-6 rounded-lg h-full">
                    <p class="font-mono text-xs text-green-400 mb-4">// 文件内容模拟 (双击卡片打开: <span id="file-name-content"></span>)</p>
                    <pre class="whitespace-pre-wrap text-slate-300 leading-relaxed">
## Q3 财务报告 - 关键摘要

本季度，公司实现了 <span class="text-indigo-400">25% 的营收增长</span>，主要由以下三个关键因素驱动：

1.  **产品线 A 扩张**：新市场（东南亚）的早期接受度超出预期，贡献了 40% 的新增收入。
2.  **SaaS 转化率提升**：通过优化付费墙体验，月度订阅用户转化为年度订阅用户的比例提升了 8%。
3.  **运营效率优化**：云计算成本通过采用新的容器化策略降低了 15%。

请与 AI 助手对话，以获取更深入的图表和分析。
                    </pre>
                </div>
            </div>
        </div>
    </div>


    <script>
        const sidebar = document.getElementById('ai-sidebar');
        const sidebarContent = document.getElementById('sidebar-content');
        const mainStage = document.getElementById('main-stage');
        const wakeBtn = document.getElementById('wake-btn');
        const input = document.getElementById('chat-input');
        const inputWrapper = document.getElementById('chat-input-wrapper');
        const loading = document.getElementById('loading-indicator');
        const fileViewerModal = document.getElementById('file-viewer-modal');
        const modalContent = document.getElementById('modal-content-area');
        const appContainer = document.getElementById('app-container');
        const floatingRobot = document.getElementById('floating-robot');

        // --- 1. AI Workspace 窗口控制 (产品化) ---

        // 打开应用窗口 (点击大眼仔)
        function openWorkspace() {
            // 隐藏大眼仔
            floatingRobot.classList.add('hidden');

            // 显示应用窗口，并触发动画
            appContainer.classList.remove('hidden');
            // 使用 setTimeout 确保浏览器先渲染 'hidden' 移除，再应用动画
            setTimeout(() => {
                appContainer.classList.remove('opacity-0', 'scale-[0.5]');
            }, 10);

            // 默认展开侧边栏
            toggleSidebar(true);
        }

        // 关闭应用窗口 (点击主窗口内的关闭按钮)
        function closeWorkspace() {
            // 触发反向动画
            appContainer.classList.add('opacity-0', 'scale-[0.5]');

            // 动画结束后隐藏窗口，并显示大眼仔
            setTimeout(() => {
                appContainer.classList.add('hidden');
                floatingRobot.classList.remove('hidden');
            }, 500); // 匹配 CSS duration-500
        }

        // --- 2. 侧边栏切换逻辑 (解决收缩后组件残留问题) ---
        function toggleSidebar(forceOpen = false) {
            const isCollapsed = sidebar.classList.contains('collapsed');

            if (isCollapsed || forceOpen) {
                // 展开逻辑
                sidebar.classList.remove('collapsed');
                sidebarContent.style.opacity = '1';
                wakeBtn.classList.add('hidden');
            } else {
                // 收缩逻辑
                sidebar.classList.add('collapsed');
                // 关键：收缩时明确隐藏内部组件，避免视觉残留
                sidebarContent.style.opacity = '0';
                wakeBtn.classList.remove('hidden');
            }
        }

        // --- 3. 沙盒区域拖拽上传 (Drag & Drop for Sandbox) ---
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            mainStage.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults (e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            mainStage.addEventListener(eventName, highlightSandbox, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            mainStage.addEventListener(eventName, unhighlightSandbox, false);
        });

        function highlightSandbox() {
            mainStage.classList.add('drag-over');
        }

        function unhighlightSandbox() {
            mainStage.classList.remove('drag-over');
        }

        mainStage.addEventListener('drop', handleSandboxDrop, false);

        function handleSandboxDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;

            if (files.length > 0) {
                let fileNames = Array.from(files).map(f => f.name).join(', ');
                // 使用自定义消息框替代 alert
                console.log(`[Notification] 成功将 ${files.length} 个文件/文件夹拖拽到沙盒！文件列表: ${fileNames}`);
            }
        }


        // --- 4. 对话框拖拽上传 (Drag & Drop for Chat Input) ---
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            inputWrapper.addEventListener(eventName, preventDefaults, false);
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            inputWrapper.addEventListener(eventName, highlightChat, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            inputWrapper.addEventListener(eventName, unhighlightChat, false);
        });

        function highlightChat() {
            inputWrapper.classList.add('drag-over-chat');
        }

        function unhighlightChat() {
            inputWrapper.classList.remove('drag-over-chat');
        }

        inputWrapper.addEventListener('drop', handleChatDrop, false);

        function handleChatDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;

            if (files.length > 0) {
                let fileNames = Array.from(files).map(f => f.name).join(', ');
                // 使用自定义消息框替代 alert
                console.log(`[Notification] 成功将 ${files.length} 个文件附加到消息中！文件列表: ${fileNames}`);
            }
        }


        // --- 5. 文件查看模拟 (File Viewer) ---
        function openFileViewer(fileName) {
            document.getElementById('file-viewer-title').textContent = `${fileName} - 预览`;
            document.getElementById('file-name-content').textContent = fileName;

            fileViewerModal.classList.remove('hidden');
            setTimeout(() => {
                fileViewerModal.classList.add('opacity-100');
                modalContent.classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function closeFileViewer(e) {
            if (e && e.target.id !== 'file-viewer-modal') return;

            fileViewerModal.classList.remove('opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');

            setTimeout(() => {
                fileViewerModal.classList.add('hidden');
            }, 300);
        }

        // --- 6. 消息发送与输入框自适应 ---
        function sendMessage() {
            const text = input.value.trim();
            if(!text) return;

            input.value = '';
            input.style.height = '3.5rem';

            loading.classList.remove('opacity-0');

            const container = document.getElementById('chat-container');
            container.scrollTop = container.scrollHeight;

            setTimeout(() => {
                loading.classList.add('opacity-0');
                console.log("AI: 收到消息 - " + text);
            }, 1500);
        }

        input.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
            if(this.value === '') this.style.height = '3.5rem';
        });

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // 页面加载时，确保大眼仔可见，应用窗口隐藏
        document.addEventListener('DOMContentLoaded', () => {
             floatingRobot.classList.remove('hidden');
             appContainer.classList.add('hidden');
        });
    </script>
</body>
</html>